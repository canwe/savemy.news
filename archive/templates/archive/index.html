{% extends "archive/base.html" %}

{% block content %}
<article>
    <header>
        <h1>Save My News</h1>
        <p>A personal, permanent clipping service from <a href="http://palewi.re/who-is-ben-welsh/">Ben Welsh</a>, <a href="http://www.pastpages.org">PastPages</a> and <a href="http://archive.org">The Internet Archive</a>.</p>
    </header>
    {% if not user.is_authenticated %}
    <section>
        <p>Sign in with <a href="{% url "social:begin" "twitter" %}?next={{ request.path }}">Twitter</a> and start saving your work.</p>
    </section>
    {% else %}
    <section>
        <p>Hello, {{ user }}. (<a href="{% url "logout" %}?next={{ request.path }}">Logout</a>)</p>
        <form action="{% url 'save' %}" method="POST">
            {% csrf_token %}
            <div class="form-group row">
              <div class="col-5">
                <input class="form-control" type="url" placeholder="http://www.yoursite.com/your-story.html" value="" name="url">
              </div>
              <div class="col-2">
                  <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </div>
        </form>
        {% if clip_list %}
            <table class="table table-sm table-responsive">
                <thead>
                  <tr>
                    <th>URL</th>
                    <th>Archive time</th>
                    <th>Archive URL</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                {% for obj in clip_list %}
                    <tr>
                        <td><a href="{{ obj.url }}">{{ obj.url|truncatechars:75 }}</a></td>
                        <td>{{ obj.memento.timestamp }}</td>
                        <td>{{ obj.memento.url|urlizetrunc:30 }}</td>
                        <td>
                            <i class="fa fa-trash"
                               aria-hidden="true"
                               data-toggle="modal"
                               data-target="#trashModal"
                               data-id="{{ obj.id }}"
                               data-url="{{ obj.url }}"
                               data-archive-url="{{ obj.memento.url }}"></i>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}
    </section>
    {% endif %}
    <section class="row share">
        <section class="col-sm-12 col-md-2 col-lg-1">
            <div class="fb-share-button" data-href="http://www.savemy.news/" data-layout="button_count" data-size="small" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.savemy.news%2F&amp;src=sdkpreparse">Share</a></div>
        </section>
        <section class="col-sm-12 col-md-2 col-lg-1">
            <a class="twitter-share-button"
              href="https://twitter.com/intent/tweet">
            Tweet</a>
        </section>
    </section>
</article>
{% endblock %}

{% block body-bottom %}
<div class="modal fade" id="trashModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Are you sure?</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form action="{% url 'delete' %}" method="POST">
          {% csrf_token %}
          <div class="modal-body">
              <p>
                  If you delete this clip, it will disappear from your private list
                  but remain <a href="" target="_blank">within the Internet Archive</a>.
              </p>
              <input type="hidden" name="id">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">No thanks</button>
            <button type="submit" class="btn btn-primary">Yes, I'm sure</button>
          </div>
      </form>
    </div>
  </div>
</div>
<script>
    $('#trashModal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget);
      var id = button.data('id');
      var archiveUrl = button.data('archive-url');
      var modal = $(this);
      modal.find('.modal-body a').attr({"href": archiveUrl});
      modal.find('.modal-body input').val(id);
    })
</script>
{% endblock %}
